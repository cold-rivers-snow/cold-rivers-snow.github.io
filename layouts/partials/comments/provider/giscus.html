{{- with .Site.Params.comments.giscus -}}
<script src="https://giscus.app/client.js"
        data-repo="cold-rivers-snow/cold-rivers-snow.github.io"
        data-repo-id="R_kgDOQFRAmg"
        data-category="Announcements"
        data-category-id="DIC_kwDOQFRAms4Cw3NC"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>
<div class="js-Pjax">
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function() {
           // 判断当前是否有文章评论标识
           let comment = document.querySelector(".comment");
           if (!comment) {
              return
           }
            let script = document.createElement('script');
            script.src = 'https://giscus.app/client.js';
            script.crossOrigin = 'anonymous';
            script.setAttribute('data-repo', 'cold-rivers-snow/cold-rivers-snow.github.io');
            script.setAttribute('data-repo-id', 'R_kgDOQFRAmg');
            script.setAttribute('data-category', 'Announcements');
            script.setAttribute('data-category-id', 'DIC_kwDOQFRAms4Cw3NC');
            script.setAttribute('data-mapping', 'pathname');
            script.setAttribute('data-strict', '0');
            script.setAttribute('data-reactions-enabled', '1');
            script.setAttribute('data-emit-metadata', '0');
            script.setAttribute('data-input-position', 'bottom');
            script.setAttribute('data-theme', 'preferred_color_scheme');
            script.setAttribute('data-lang', 'zh-CN');
            script.setAttribute('crossorigin', 'anonymous');
            script.setAttribute('data-loading', 'lazy');
            script.async = true;
            document.querySelector('.site-footer').appendchild(script)
            
            (function () {
                addEventListener("message", (e) => {
                   if (event.origin !== "https://giscus.app") return;
                    handler();
                });
                window.addEventListener("onColorSchemeChange", handler);

                function handler() {
                    if (document.documentElement.dataset.scheme === "light") {
                        setGiscusTheme('{{- default "light" .lightTheme -}}');
                    } else {
                        setGiscusTheme('{{- default "dark_dimmed" .darkTheme -}}');
                    }
                }
            })();
        })(document)
</script>
</div>
{{- end -}}
